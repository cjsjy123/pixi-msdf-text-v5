!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.MSDFText=e():t.MSDFText=e()}("undefined"!=typeof self?self:this,function(){return function(t){function e(r){if(o[r])return o[r].exports;var i=o[r]={i:r,l:!1,exports:{}};return t[r].call(i.exports,i,i.exports,e),i.l=!0,i.exports}var o={};return e.m=t,e.c=o,e.d=function(t,o,r){e.o(t,o)||Object.defineProperty(t,o,{configurable:!1,enumerable:!0,get:r})},e.n=function(t){var o=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(o,"a",o),o},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="",e(e.s=0)}([function(t,e,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=o(1);e.MSDFText=r.MSDFText},function(t,e,o){"use strict";var r=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])};return function(e,o){function r(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(r.prototype=o.prototype,new r)}}();Object.defineProperty(e,"__esModule",{value:!0});var i=o(2),n=o(3),a=function(){function t(){}return t.Create=function(e,o,r,i,n,a,s,h,f,u){var c=null;return c=t._pool.length>0?t._pool.pop():new t,c.set(e,o,r,i,n,a,s,h,f,u),c},t.prototype.set=function(t,e,o,r,i,n,a,s,h,f){this.line=t,this.charCode=e,this.drawRect||(this.drawRect=new PIXI.Rectangle),this.drawRect.x=o,this.drawRect.y=r,this.drawRect.width=i,this.drawRect.height=n,this.rawRect||(this.rawRect=new PIXI.Rectangle),this.rawRect.x=a,this.rawRect.y=s,this.rawRect.width=h,this.rawRect.height=f},t.prototype.dispose=function(){t._pool.push(this)},t._pool=new Array,t}(),s=function(t){function e(e,o){var r=this,a=new PIXI.Geometry,s=new PIXI.Buffer(null,!1,!0),h=new PIXI.Buffer(null,!1,!1),f=new PIXI.Buffer(null,!1,!1);a.addIndex(s).addAttribute("aVertexPosition",f).addAttribute("aTextureCoord",h);var u=new PIXI.Program(i,n,"MSDFShader"),c={},d=new PIXI.Shader(u,c);return r=t.call(this,a,d)||this,r.indices=s,r.uvs=h,r.vertices=f,r.shader=d,r.texture=o.texture||PIXI.Texture.WHITE,r._text=e,r._font={fontFace:o.fontFace,fontSize:o.fontSize,color:void 0===o.fillColor?16711680:o.fillColor,weight:void 0===o.weight?.5:1-o.weight,align:o.align,kerning:void 0===o.kerning||o.kerning,strokeColor:o.strokeColor||0,dropShadow:o.dropShadow||!1,dropShadowColor:o.dropShadowColor||0,dropShadowAlpha:void 0===o.dropShadowAlpha?.5:o.dropShadowAlpha,dropShadowBlur:o.dropShadowBlur||0,dropShadowOffset:o.dropShadowOffset||new PIXI.Point(2,2),pxrange:void 0===o.pxrange?3:o.pxrange},void 0===o.strokeThickness||0===o.strokeThickness?r._font.strokeWeight=0:r._font.strokeWeight=r._font.weight-o.strokeThickness,r.nocheck=o.noCheck||!1,r._baselineOffset=void 0===o.baselineOffset?0:o.baselineOffset,r._letterSpacing=void 0===o.letterSpacing?0:o.letterSpacing,r._lineSpacing=void 0===o.lineSpacing?0:o.lineSpacing,r._textWidth=r._textHeight=0,r._maxWidth=o.maxWidth||0,r._textMetricsBound=new PIXI.Rectangle,r.chars=[],r.cachepoint=new PIXI.Point,r.updateText(),r}return r(e,t),Object.defineProperty(e.prototype,"text",{get:function(){return this._text},set:function(t){this._text=this.unescape(t),this.updateText()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fontData",{get:function(){return this._font},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"textWidth",{get:function(){return this._textWidth},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"textHeight",{get:function(){return this._textHeight},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"maxWidth",{get:function(){return this._maxWidth},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"textMetric",{get:function(){return this._textMetricsBound},enumerable:!0,configurable:!0}),e.prototype.isSpace=function(t){return 9==t||11==t||12==t||32==t},e.prototype.isToNextLine=function(t,e){return 13===t&&10===e?2:13==t?1:10==t?1:-1},e.prototype.updateText=function(){var t=PIXI.BitmapText.fonts[this._font.fontFace];if(!t)throw new Error("Invalid fontFace: "+this._font.fontFace);var e=this.getBitmapTexture(this._font.fontFace);this._font.rawSize=t.size;var o=this._font.fontSize/t.size,r=e.width,i=e.height;this.cachepoint.x=0,this.cachepoint.y=-this._baselineOffset*o;for(var n=-1,s=0,h=0,f=0,u=-1,c=0,d=0,l=0,p=0,x=0;x<this._text.length;x++){var g=this._text.charCodeAt(x),w=x+1<this._text.length?this._text.charCodeAt(x+1):-1;if(this.isSpace(g)&&(u=x,c=s),this.isToNextLine(g,w)>0)s-=this._letterSpacing,h=Math.max(h,s),f++,this.cachepoint.x=0,this.cachepoint.y+=t.lineHeight*o+this._lineSpacing*o,n=-1;else if(-1!==u&&this._maxWidth>0&&this.cachepoint.x>this._maxWidth)PIXI.utils.removeItems(this.chars,u-d,x-u),x=u,u=-1,++d,c-=this._letterSpacing,h=Math.max(h,c),f++,this.cachepoint.x=0,this.cachepoint.y+=t.lineHeight*o+this._lineSpacing*o,n=-1;else{var m=t.chars[g];if(m){this._font.kerning&&-1!==n&&m.kerning[n]&&(this.cachepoint.x+=m.kerning[n]*o);var _=this.chars[p];_?_.set(f,g,this.cachepoint.x+m.xOffset*o,this.cachepoint.y+m.yOffset*o,m.texture.width*o,m.texture.height*o,m.texture.orig.x,m.texture.orig.y,m.texture.width,m.texture.height):(_=a.Create(f,g,this.cachepoint.x+m.xOffset*o,this.cachepoint.y+m.yOffset*o,m.texture.width*o,m.texture.height*o,m.texture.orig.x,m.texture.orig.y,m.texture.width,m.texture.height),this.chars.push(_)),p++,this.cachepoint.x+=(m.xAdvance+this._letterSpacing)*o,s=this.cachepoint.x,l=Math.max(l,this.cachepoint.y+t.lineHeight*o),n=g}}}if(p<this.chars.length){for(var v=p;v<this.chars.length;v++){var y=this.chars[v];y&&y.dispose()}this.chars.splice(p,this.chars.length-p)}h=Math.max(h,s),this._textWidth=h,this._textHeight=l,this._textMetricsBound.width=l,this._textMetricsBound.height=l,this.vertices.update(this.toVertices(this.vertices.data,this.chars)),this.uvs.update(this.toUVs(this.uvs.data,this.chars,r,i)),this.indices.update(this.createIndicesForQuads(this.indices.data,this.chars.length)),this.shader.uniforms.uSampler!==e&&(this.shader.uniforms.uSampler=e),this.updateUniforms()},e.prototype.updateUniforms=function(){this.worldarray||(this.worldarray=new Float32Array(9)),this.soffsetarray||(this.soffsetarray=new Float32Array(2)),this.worldTransform.toArray(!0,this.worldarray),this.soffsetarray[0]=this._font.dropShadowOffset.x,this.soffsetarray[1]=this._font.dropShadowOffset.x,this.shader.uniforms.translationMatrix=this.worldarray,this.shader.uniforms.u_alpha=this.worldAlpha,this.shader.uniforms.u_color=PIXI.utils.hex2rgb(this._font.color),this.shader.uniforms.u_fontSize=this._font.fontSize*this.scale.x,this.shader.uniforms.u_fontInfoSize=1,this.shader.uniforms.u_weight=this._font.weight,this.shader.uniforms.u_pxrange=this._font.pxrange,this.shader.uniforms.strokeWeight=this._font.strokeWeight,this.shader.uniforms.strokeColor=PIXI.utils.hex2rgb(this._font.strokeColor),this.shader.uniforms.tint=PIXI.utils.hex2rgb(this.tint),this.shader.uniforms.hasShadow=this._font.dropShadow,this.shader.uniforms.shadowOffset=this.soffsetarray,this.shader.uniforms.shadowColor=PIXI.utils.hex2rgb(this._font.dropShadowColor),this.shader.uniforms.shadowAlpha=this._font.dropShadowAlpha,this.shader.uniforms.shadowSmoothing=this._font.dropShadowBlur},e.prototype.getBitmapTexture=function(t){var e=PIXI.BitmapText.fonts[t];if(!e)return PIXI.Texture.EMPTY;for(var o in e.chars){var r=e.chars[o],i=r.texture.baseTexture.resource.url;return PIXI.utils.TextureCache[i]}return PIXI.Texture.EMPTY},e.prototype.toVertices=function(t,e){var o=4*e.length*2,r=null;r=t&&t.length===o?t:new Float32Array(o);for(var i=0,n=0,a=e;n<a.length;n++){var s=a[n],h=s.drawRect.x,f=s.drawRect.y,u=s.drawRect.width,c=s.drawRect.height;r[i++]=h,r[i++]=f,r[i++]=h,r[i++]=f+c,r[i++]=h+u,r[i++]=f+c,r[i++]=h+u,r[i++]=f}return r},e.prototype.toUVs=function(t,e,o,r){var i=4*e.length*2,n=null;n=t&&t.length===i?t:new Float32Array(i);for(var a=0,s=0,h=e;s<h.length;s++){var f=h[s],u=f.rawRect.x/o,c=(f.rawRect.x+f.rawRect.width)/o,d=(f.rawRect.y+f.rawRect.height)/r,l=f.rawRect.y/r;n[a++]=u,n[a++]=l,n[a++]=u,n[a++]=d,n[a++]=c,n[a++]=d,n[a++]=c,n[a++]=l}return n},e.prototype.createIndicesForQuads=function(t,e){var o=6*e,r=null;r=t&&t.length===o?t:new Uint16Array(o);for(var i=0,n=0;i<o;i+=6,n+=4)r[i+0]=n+0,r[i+1]=n+1,r[i+2]=n+2,r[i+3]=n+0,r[i+4]=n+2,r[i+5]=n+3;return r},e.prototype.drawGizmoRect=function(t,e,o,r){void 0===e&&(e=1),void 0===o&&(o=16777215),void 0===r&&(r=1);var i=new PIXI.Graphics;i.lineStyle(e,o,r,.5,!0).drawRect(t.x,t.y,t.width,t.height),this.addChild(i)},e.prototype.unescape=function(t){return this.nocheck?t:t.replace(/(\\n|\\r)/g,"\n")},e.Debug=!1,e}(PIXI.Mesh);e.MSDFText=s},function(t,e){t.exports="#define GLSLIFY 1\nattribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 translationMatrix;\nuniform mat3 projectionMatrix;\nuniform float u_fontInfoSize;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    vTextureCoord = aTextureCoord;\n    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition * u_fontInfoSize, 1.0)).xy, 0.0, 1.0);\n}\n"},function(t,e){t.exports="#define GLSLIFY 1\nvarying vec2 vTextureCoord;\nuniform vec3 u_color;\nuniform sampler2D uSampler;\nuniform float u_alpha;\nuniform float u_fontSize;\nuniform float u_weight;\nuniform float u_pxrange;\n\nuniform vec3 tint;\n// Stroke effect parameters\nuniform float strokeWeight;\nuniform vec3 strokeColor;\n\n// Shadow effect parameters\nuniform bool hasShadow;\nuniform vec2 shadowOffset;\nuniform float shadowSmoothing;\nuniform vec3 shadowColor;\nuniform float shadowAlpha;\n\nfloat median(float r, float g, float b) {\n    return max(min(r, g), min(max(r, g), b));\n}\n\nvoid main(void)\n{\n    float smoothing = clamp(2.0 * u_pxrange / u_fontSize, 0.0, 0.5);\n\n    vec2 textureCoord = vTextureCoord * 2.;\n    vec3 sample = texture2D(uSampler, vTextureCoord).rgb;\n    float dist = median(sample.r, sample.g, sample.b);\n\n    float alpha;\n    vec3 color;\n\n    // dirty if statment, will change soon\n    if (strokeWeight > 0.0) {\n        alpha = smoothstep(strokeWeight - smoothing, strokeWeight + smoothing, dist);\n        float outlineFactor = smoothstep(u_weight - smoothing, u_weight + smoothing, dist);\n        color = mix(strokeColor, u_color, outlineFactor) * alpha;\n    } else {\n        alpha = smoothstep(u_weight - smoothing, u_weight + smoothing, dist);\n        color = u_color * alpha;\n    }\n    vec4 text = vec4(color * tint, alpha) * u_alpha;\n    if (hasShadow == false) {\n        gl_FragColor = text;\n    } else {\n        vec3 shadowSample = texture2D(uSampler, vTextureCoord - shadowOffset).rgb;\n        float shadowDist = median(shadowSample.r, shadowSample.g, shadowSample.b);\n        float distAlpha = smoothstep(0.5 - shadowSmoothing, 0.5 + shadowSmoothing, shadowDist);\n        vec4 shadow = vec4(shadowColor, shadowAlpha * distAlpha);\n        gl_FragColor = mix(shadow, text, text.a);\n    }\n}"}])});